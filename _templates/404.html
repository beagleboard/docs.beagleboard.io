{% extends "pydata_sphinx_theme/layout.html" %}

{% set title = "Page Not Found (404)" %}

{% block title %}{{ title }}{% endblock %}

{% block extrahead %}
<script>
    // The redirect_folders dictionary is passed from html_context
    const redirectFolders = JSON.parse('{{ redirect_folders | tojson | safe }}');

    // Get the current URL
    let currentUrl = window.location.href;

    // Iterate over the redirect_folders key-value pairs
    for (const [key, value] of Object.entries(redirectFolders)) {
        if (currentUrl.includes("/" + key)) {
            // Determine the replacement value
            let replacement = value === "" ? "" : "/" + value;

            // Create a new URL by replacing "/key" with the replacement value
            let newUrl = currentUrl.replace("/" + key, replacement);

            // Hide content while determining the redirection
            document.documentElement.style.display = 'none';

            // Make an HTTP request to check if the new URL exists
            fetch(newUrl, { method: "HEAD" })
                .then(response => {
                    // If the response is OK (status code in the range 200â€“299), redirect to the new URL
                    if (response.ok) {
                        window.location.href = newUrl;
                    } else {
                        // If not redirecting, make the page content visible
                        document.documentElement.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error("Error checking the URL:", error);
                    // If there was an error, make the page content visible
                    document.documentElement.style.display = 'block';
                });

            // Stop after the first successful replacement
            break;
        }
    }
</script>
{{ super() }}
{% endblock %}

{% block docs_body %}
<div class="document">
    <h1>{{ title }}</h1>
    <p>Oops! The page you're looking for does not exist.</p>
    <p>You can return to the <a href="{{ pathto(master_doc) }}">home page</a>.</p>
    <p>If you believe this is a broken link, please <a data-bs-toggle="modal" data-bs-target="#feedbackModal" href="#"
            onclick="getFeedbackButtonhref(this)">let us know</a>.</p>
</div>
{{ super() }}
{% endblock %}