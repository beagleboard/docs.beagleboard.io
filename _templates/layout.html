{% extends "pydata_sphinx_theme/layout.html" %}

{% block docs_navbar %}

    <!-- Top version and announcement message -->
    <script>
        
    // Function to generate version and announcement banner HTML
    function getBannerHTML() {
        return `
            {% if 'docs.beagleboard.org' not in docs_url%}
            <aside id="bd-header-version-warning" class="d-print-none" aria-label="Version warning">
                <div class="bd-header-announcement__content ms-auto me-auto">
                    <div class="sidebar-message">
                        {{ current_url }}
                        {% if 'beagleboard.io/docs.beagleboard.io' in docs_url %}
                        {{forked_version_message}}
                        {% elif 'docs.beagleboard.io' in docs_url %}
                        {{development_version_message}}
                        {% else %}
                        {{unknown_version_message}}
                        {% endif %}
                        <a class="btn text-wrap font-weight-bold ms-3 my-1 align-baseline pst-button-link-to-stable-version" href="{{version_link}}">
                            {{version_link_text}}
                        </a>
                    </div>
                </div>
            </aside>
            {% endif %}
            {% if announcement_message != '' %}
            <aside class="bd-header-announcement" aria-label="Announcement">
                <div class="bd-header-announcement__content">{{ announcement_message }}</div>
            </aside>
            {% endif %}
        `;
    }
    
    // Get the target element where the banners will be added
    const bannerDiv = document.getElementsByClassName('pst-async-banner-revealer')[0];

    // Add version banner and announcement banner if bannerDiv is valid
    if (bannerDiv) {
        bannerDiv.innerHTML = getBannerHTML();
    }
    
    </script>

    {{ super() }}

{% endblock docs_navbar %}

{% block docs_main %}
<script>

document.addEventListener('DOMContentLoaded', () => {
    // Select the sidebar and create the custom toggle button
    const sidebar = document.getElementById('pst-primary-sidebar');
    const toggleButton = document.createElement('button');
    toggleButton.id = 'toggle-primary-sidebar';
    toggleButton.innerHTML = '<strong>&lt;</strong>'; // Initial content
    toggleButton.className = 'sidebar-toggle-btn'; // Add class for styling

    // Insert the button after the sidebar
    sidebar.parentNode.insertBefore(toggleButton, sidebar.nextSibling);

    // Function to check visibility of the primary sidebar toggle button
    function checkPrimaryToggleVisibility() {
        const primaryToggleButton = document.querySelector('.pst-navbar-icon.sidebar-toggle.primary-toggle');
        
        // If the primary toggle button is visible, hide the custom toggle button
        if (primaryToggleButton && primaryToggleButton.offsetParent !== null) {
            toggleButton.style.display = 'none'; // Hide custom button
        } else {
            toggleButton.style.display = 'block'; // Show custom button
        }
    }

    // Function to update the button visibility based on the sidebar state
    function updateButtonVisibility() {
        // Check if the sidebar is hidden via display: none
        if (sidebar && window.getComputedStyle(sidebar).display === 'none') {
            // If the sidebar is hidden, remove the button from the DOM
            if (toggleButton) {
                toggleButton.remove();
            }
        } else {
            // Ensure the button is added back if it was removed
            if (!document.querySelector('#toggle-primary-sidebar')) {
                sidebar.parentNode.insertBefore(toggleButton, sidebar.nextSibling);
            }
        }
    }
    // Initially check visibility of the primary toggle button
    checkPrimaryToggleVisibility();
    updateButtonVisibility();

    // Toggle sidebar collapse/expand functionality
    toggleButton.addEventListener('click', () => {
        sidebar.classList.toggle('collapsed');
        
        // Update button content based on sidebar state
        if (sidebar.classList.contains('collapsed')) {
            toggleButton.innerHTML = '<strong>&gt;</strong>'; // When collapsed
        } else {
            toggleButton.innerHTML = '<strong>&lt;</strong>'; // When expanded
        }
    });

    // Monitor window resize to dynamically show/hide the button
    window.addEventListener('resize', () => {
        checkPrimaryToggleVisibility();
        updateButtonVisibility();
    });
});

</script>
{{ super() }}

{% endblock docs_main %}